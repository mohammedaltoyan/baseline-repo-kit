name: Deploy

on:
  workflow_dispatch:
    inputs:
      environment:
        description: "GitHub environment to deploy to (recommended: staging|production)"
        required: true
        default: production
      ref:
        description: "Git ref to deploy (optional; defaults to the workflow commit SHA)"
        required: false
        default: ""

permissions:
  contents: read

jobs:
  deploy:
    if: ${{ vars.DEPLOY_ENABLED == '1' }}
    runs-on: ubuntu-latest
    timeout-minutes: 30
    environment: ${{ inputs.environment }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          ref: ${{ inputs.ref || github.sha }}

      - name: Deploy (hook)
        shell: bash
        env:
          DEPLOY_ENV: ${{ inputs.environment }}
        run: |
          set -euo pipefail

          if [ -f "scripts/deploy/deploy.sh" ]; then
            bash scripts/deploy/deploy.sh
            exit 0
          fi

          echo "Missing scripts/deploy/deploy.sh."
          echo "Implement a project-specific deploy hook and re-run this workflow."
          exit 1

