{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://baseline-kit.local/schema/effective-settings-rules.schema.json",
  "title": "Baseline Effective Settings Rules",
  "type": "object",
  "additionalProperties": false,
  "required": ["version", "rules"],
  "properties": {
    "version": {
      "type": "integer",
      "minimum": 1
    },
    "rules": {
      "type": "array",
      "items": {
        "$ref": "#/definitions/effectiveRule"
      }
    }
  },
  "definitions": {
    "effectiveRule": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "id",
        "path",
        "capability",
        "module",
        "effective_value",
        "reason",
        "detail_template",
        "remediation"
      ],
      "anyOf": [
        { "required": ["when"] },
        { "required": ["when_configured_equals"] }
      ],
      "properties": {
        "id": {
          "type": "string",
          "minLength": 1
        },
        "path": {
          "type": "string",
          "minLength": 1
        },
        "capability": {
          "type": "string",
          "minLength": 1
        },
        "module": {
          "type": "string",
          "minLength": 1
        },
        "when": {
          "$ref": "#/definitions/ruleWhen"
        },
        "when_configured_equals": {
          "type": "boolean"
        },
        "effective_value": {},
        "reason": {
          "type": "string",
          "minLength": 1
        },
        "detail_template": {
          "type": "string",
          "minLength": 1
        },
        "remediation": {
          "type": "string"
        }
      }
    },
    "ruleWhen": {
      "type": "object",
      "additionalProperties": false,
      "required": ["operator"],
      "properties": {
        "operator": {
          "type": "string",
          "enum": ["equals", "not_equals", "in", "not_in"]
        },
        "value": {},
        "values": {
          "type": "array"
        }
      },
      "allOf": [
        {
          "if": {
            "properties": { "operator": { "enum": ["equals", "not_equals"] } },
            "required": ["operator"]
          },
          "then": { "required": ["value"] }
        },
        {
          "if": {
            "properties": { "operator": { "enum": ["in", "not_in"] } },
            "required": ["operator"]
          },
          "then": {
            "required": ["values"],
            "properties": {
              "values": {
                "type": "array",
                "minItems": 1
              }
            }
          }
        }
      ]
    }
  }
}
